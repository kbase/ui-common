<!DOCTYPE html>

<html>

    <head>

        <!--<link href="../../ext/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet">
        <link href="../../ext/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">

        <script data-main = '../../src/kbpaths' src = '../../ext/requirejs/2.1.9/require.js'></script>-->

<link href="../../ext/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
<link href="../../ext/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">

<script data-main = '../../src/kbpaths' src = '../../ext/requirejs/2.1.9/require.js'></script>

<script type = 'text/javascript'>
    var kb_use_require = true;
    var kb_norequire = function(deps, callback) {
        callback(jQuery);
    };
    var kb_nodefine = function(module, deps, callback) {
        callback(jQuery);
    };
    if (kb_use_require) {
        kb_define = define;
        kb_require = require;
    }
    else {
        kb_define = kb_nodefine;
        kb_require = kb_norequire;
    }
</script>

<style>
.bar {

}

.axis path,
.axis line {
    fill: none;
    stroke: black;
    shape-rendering: crispEdges;
}

.axis text {
    font-family: sans-serif;
    font-size: 11px;
}

</style>


        <script type = 'text/javascript'>
            <!--

                function getParameterByName(name) {
                  name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
                  var regexS = "[\\?&]" + name + "=([^&#]*)";
                  var regex = new RegExp(regexS);
                  var results = regex.exec(window.location.search);
                  if(results == null)
                    return "";
                  else
                    return decodeURIComponent(results[1].replace(/\+/g, " "));
                }

                require(['kbpaths'], function() {
                    require(['jquery', 'vis', 'kbaseRNASeq', 'kbaseRNASeqPie',
                        ], function($) {
                        $(function() {



                            function generate_rna_data () {
                                var pmi = { subsystems : {} };
                                var pmi_subs = pmi.subsystems;

                                var subsystems = ['Glycine metabolism', 'Serine metabolism', 'Some other metabolism', 'Important metabolism'];

                                for (var s = 0; s < subsystems.length; s++) {

                                    var sub = subsystems[s];

                                    var bars = [];

                                    for (var i = 4; i < Math.random() * 30 + 4; i++) {

                                        var val = Math.random() * 20 - 10;

                                        bars.push(
                                            {
                                                bar   : i,
                                                value : val,
                                                tooltip : 'Pop up for ' + val
                                            }
                                        );
                                    }

                                    pmi_subs[sub] = bars;

                                }

                                return pmi;

                            }

                            var $rna = $('#RNASeqWidget').kbaseRNASeq(
                                {
                                    //dataset : generate_rna_data(),
                                }
                            );
                            $rna.setDataset(generate_rna_data());

                            $('#pie-button').on('click', function(e) {
                                $rna.setDataset(generate_rna_data());
                            });




                            function generate_pie_data () {

                                var data = {
                                    properly_paired : Math.floor(Math.random() * 100),
                                    multiple_alignments: Math.floor(Math.random() * 100),
                                    singletons: Math.floor(Math.random() * 100),
                                    alignment_rate : Math.floor(Math.random() * 100),
                                    mapped_reads: Math.floor(Math.random() * 100),
                                    unmapped_reads  :  Math.floor(Math.random() * 100),
                                    mapped_reads : {
                                        exons    : Math.floor(Math.random() * 25),
                                        splice_junctions   : Math.floor(Math.random() * 25),
                                        intergenic_regions : Math.floor(Math.random() * 25),
                                        introns   : Math.floor(Math.random() * 25)
                                    },
                                    unmappedd_reads : {
                                        able : 15,
                                        baker : 25,
                                        charlie : 30
                                    },
                                }

                                //data.total_reads = data.mapped_reads + data.unmapped_reads;
                                return data;

                            }

                            var $pie = $('#RNASeqPieWidget').kbaseRNASeqPie(
{  "dataset" : {
                         "properly_paired" : 100 ,
                         "multiple_alignments": 50 ,
                         "singletons": 50 ,
                         "alignment_rate": 80,
                         "mapped_reads" : 200,
                         "unmapped_reads"  :  50,
                         "total_reads" : 250,
                         "mapped_reads" : {
                               "introns" : 50,
                               "exons" : 75,
                               "splice_junctions" : 100,
                               "intergenic_regions" : 55
                         }
                     } }
                            );

                            //$pie.setDataset(generate_pie_data());


                            $('#pie-button').on('click', function(e) {
                                $pie.setDataset(generate_pie_data());
                            });

                        })
                    })
                })


            //-->
        </script>
    </head>

    <body>



            <div style = 'display : none'>
                <div id = 'RNASeqWidget' style = 'border : 1px solid green; width : 800px; height : 600px'></div>
                <button id = 'rna-button'>New data</button>

                <br><br><br><br>
            </div>
            <div id = 'RNASeqPieWidget' style = 'border : 0px solid green; width : 800px; height : 600px'></div>
            <button id = 'pie-button'>New data</button>

    </body>

</html>
